Tokamak example
===============

Input grid
----------

To run these examples, you will need a grid file for a tokamak. 
These can be generated by [Hypnotoad](https://github.com/boutproject/hypnotoad). 

The BOUT.inp input files assume that this grid file is in the same
directory as this README, and is called `tokamak-grid.nc`

Curvature
~~~~~~~~~

**Important** The magnetic curvature is used in calculating the drift
when diamagnetic current is enabled. To ensure that the flux-surface
average radial flux is zero when pressure is constant on a flux
surface, the quantity J * Curl(b/B) must be zero. If this is not the case,
then large spurious radial currents and flows can result. 

A python script is included, `adjust_curvature.py` which will modify
the radial component of the curvature such that J * Curl(b/B) sums to
zero over closed flux surfaces. Note that this doesn't currently ensure that
Div( Curl(b/B) ) is zero, as the poloidal component of Curl(b/B) is not
modified. To use the script

    $ ./adjust_curvature.py thegridfile.nc

This will modify `thegridfile.nc`.

Simulations
-----------

First run the transport case. This includes neutrals, cross-field
diffusion, but no currents or drifts.

    $ mpirun -np 16 ./hermes-2 -d 1-no-currents

This will run for approx. 30 minutes, for a simulation time of 1e5/wci,
sufficient to reach steady state.

Then turn on currents and diamagnetic drift. Copy the `BOUT.restart.*` files
from `1-no-currents` into `2-currents` and restart:

    $ cp 1-no-currents/BOUT.restart.* 2-currents/
    $ mpirun -np 16 ./hermes-2 -d 2-currents restart

